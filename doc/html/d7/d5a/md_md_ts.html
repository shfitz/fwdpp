<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fwdpp: Tree sequences</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fwdpp
   &#160;<span id="projectnumber">0.7.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tree sequences </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>fwdpp 0.7.0 introduced support for generating "succinct tree sequences" during simulations. See <a class="el" href="../../d0/de3/citelist.html#CITEREF_Kelleher2016-cb">[1]</a> for background on the data structures and <a class="el" href="../../d0/de3/citelist.html#CITEREF_Kelleher2018-fu">[2]</a> on their application to forward simulation.</p>
<p>Some readers will probably find the <a href="https://msprime.readthedocs.io/en/stable/">msprime documentation</a> helpful here, as many of the big-picture concepts are the same. The relevant section of that documentation is titled "Tree sequence interchange".</p>
<h2>Example programs</h2>
<p>I encourage you to read the <a href="https://tskit-dev.github.io/tutorials/">tutorials</a> that we have written for the tskit project. The tutorials on forward-time simulation give an overview of the logic of a simulation. While the overall idea of "generate nodes and edges, simplify every now and then, repeat" is straightforward, there are some gotchas that tripped up the authors of <a class="el" href="../../d0/de3/citelist.html#CITEREF_Kelleher2018-fu">[2]</a> more than a few times.</p>
<ol type="1">
<li><a class="el" href="../../d9/d59/wfts_8cc.html">wfts.cc</a> implements a Wright-Fisher simulation with selection, ancestral sample recording, and ancestral sample metadata tracking. Command line switches also enable extensive testing of the data structures.</li>
<li><a class="el" href="../../d2/df8/spatialts_8cc.html">spatialts.cc</a> implements a simplistic method of simulating discrete generations on a continuous landscape. The methods used in this example are <b>not</b> what one would do in research-quality code. Rather, the example is illustrative, and shows how the geographic locations of preserved samples may be tracked.</li>
</ol>
<h2>Namespace</h2>
<p>Tree sequence support is found in namespace <a class="el" href="../../d8/d31/namespacefwdpp_1_1ts.html" title="Tree sequence  support. ">fwdpp::ts</a>. Like the rest of fwdpp, it is header-only.</p>
<h2>Data types</h2>
<ol type="1">
<li>Nodes and edges are defined by <a class="el" href="../../d5/d4f/structfwdpp_1_1ts_1_1node.html">fwdpp::ts::node</a> and <a class="el" href="../../d3/d25/structfwdpp_1_1ts_1_1edge.html" title="An edge in a tree sequence. ">fwdpp::ts::edge</a>, respectively.</li>
<li>Mutations are tracked on trees via <a class="el" href="../../d4/d5e/structfwdpp_1_1ts_1_1mutation__record.html">fwdpp::ts::mutation_record</a>.</li>
</ol>
<p>Node, edge, and mutation tables are stored as vectors of the above three types.</p>
<p><a class="el" href="../../d7/de8/structfwdpp_1_1ts_1_1table__collection.html" title="A collection of tables for a single simulation. ">fwdpp::ts::table_collection</a> holds node, edge, and mutation tables.</p>
<p><a class="el" href="../../dc/d0a/classfwdpp_1_1ts_1_1table__simplifier.html" title="Implements the simplification algorithm of . ">fwdpp::ts::table_simplifier</a> is responsible for applying the simplification algorithm of <a class="el" href="../../d0/de3/citelist.html#CITEREF_Kelleher2018-fu">[2]</a> to a <a class="el" href="../../d7/de8/structfwdpp_1_1ts_1_1table__collection.html" title="A collection of tables for a single simulation. ">fwdpp::ts::table_collection</a>.</p>
<h2>Relationship to msprime/tskit</h2>
<p>I'll refer to <em>tskit</em> here, which means the part of msprime dealing with tree sequences.</p>
<ol type="1">
<li>Node times are measured forwards in time. See <a class="el" href="../../d5/d4f/structfwdpp_1_1ts_1_1node.html">fwdpp::ts::node</a>.</li>
<li>The mutation table is simply a vector of records tracking nodes where mutations occur on the tree and their indexes in the population. See <a class="el" href="../../d4/d5e/structfwdpp_1_1ts_1_1mutation__record.html">fwdpp::ts::mutation_record</a>. Thus, the concept of a "sites table" and a "mutation table" are merged in fwdpp.</li>
<li>The default storage format is a custom format. Once a standalone tskit C library is available, we will likely provide direct access to storage in that tree file format as well. The current binary format is required for things like MPI, Python pickling, etc., though, so it'll stick around.</li>
</ol>
<h2>Iterating over trees</h2>
<p><a class="el" href="../../df/d8f/classfwdpp_1_1ts_1_1tree__visitor.html" title="Class that iterates over marginal trees. ">fwdpp::ts::tree_visitor</a> iterates over the non-recombining segments ("marginal trees") in the pedigree. This type defines a call operator that handles the iteration, updating an internal variable of type <a class="el" href="../../d2/d6a/classfwdpp_1_1ts_1_1marginal__tree.html" title="A non-recombining tree. ">fwdpp::ts::marginal_tree</a>.</p>
<div class="image">
<img src="../../tree.png" alt="tree.png"/>
<div class="caption">
A simplified, fully-coalesced marginal tree</div></div>
<p> Consider the tree shown above. It has 7 nodes. The parent list of the tree is represented as a linear vector (<a class="el" href="../../d2/d6a/classfwdpp_1_1ts_1_1marginal__tree.html#a4e8a7ee32191ef5b8d32731d9b71143b">fwdpp::ts::marginal_tree::parents</a>), and would contain the following values:</p>
<div class="fragment"><div class="line">4 4 5 5 6 6 fwdpp::ts::TS_NULL_NODE</div></div><!-- fragment --><p>The final value, which is the parent of the node labelled <b>6</b>, is <a class="el" href="../../d8/d31/namespacefwdpp_1_1ts.html#a3b6e884129b83242fc56f14784a2a3d8" title="Index value of a NULL node. ">fwdpp::ts::TS_NULL_NODE</a>, which signifies that there is no parent.</p>
<p>Iteration over parents is trivial:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> visit_parents(<span class="keyword">const</span> <a class="code" href="../../d8/d31/namespacefwdpp_1_1ts.html#af35a0875d0656933d78cc7840a662aa5">fwdpp::ts::TS_NODE_INT</a> n, <span class="keyword">const</span> <a class="code" href="../../d2/d6a/classfwdpp_1_1ts_1_1marginal__tree.html">fwdpp::ts::marginal_tree</a> &amp; m)</div><div class="line">{</div><div class="line"> <span class="keyword">auto</span> p = <a class="code" href="../../d9/dc6/gamete__cleanerTest_8cc.html#a45e189124b91a4bec0bfe1dc5c01ed13">n</a>;</div><div class="line"> <span class="keywordflow">while</span>(p != <a class="code" href="../../d8/d31/namespacefwdpp_1_1ts.html#a3b6e884129b83242fc56f14784a2a3d8">fwdpp::ts::TS_NULL_NODE</a>)</div><div class="line"> {</div><div class="line">    p = m.<a class="code" href="../../d2/d6a/classfwdpp_1_1ts_1_1marginal__tree.html#a4e8a7ee32191ef5b8d32731d9b71143b">parents</a>[p];</div><div class="line"> }</div><div class="line">}</div></div><!-- fragment --><p>Of course, a real-world application would have to provide bounds-checking, and would probably actually <em>do</em> something with <code>p</code> at each iteration. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
